---
title: "Strings and regex in R"
subtitle: "https://github.com/ecodatasci-tlv/strings-and-regex"
date: "`r Sys.Date()`"
output:
  xaringan::moon_reader:
    lib_dir: libs
    css: ["default", "custom-fonts.css"]
    nature:
      highlightStyle: github
      highlightLines: true
      ratio: '16:9'
      beforeInit: "https://platform.twitter.com/widgets.js"
---
```{r setup, include=FALSE}
library(knitr)
library(tidyverse)
options(tibble.print_min = 5)
conflicted::conflict_prefer("filter", "dplyr")
```

# When does it come up?

- data stored as notes
- non-uniformly formatted data
- filenames
- almost everywhere

---

# What are strings?

Strings (character types) = pretty much anything surrounded by quotes

**Double quotes** are the preferred style unless your text contains double quotes

.center[
![](https://media.giphy.com/media/xTiN0z1dTpeedhds8o/giphy.gif)
]

---

.center[.img-med[
![](https://media.giphy.com/media/HUjc0sbfgaInK/giphy.gif)
]]

### `"Keeps away the nargles."`  

--
### `'Luna whispered, "Keeps away the nargles."'`  

--
### `"Luna's eyes widened, and she whispered, \"Keeps away the nargles.\""`


---

# What's with the slash?

.center[.img-big[
![](https://media.giphy.com/media/gCwXh8EHKKfMk/giphy.gif)
]]
 
---

# Escaped characters

Special characters that may have an alternate meaning

In our previous case: is `"` literally a double-quote (chook-chik) or is it marking a character string?  

--

Some other examples:

`\n` = new line  
`\t` = tab  
`\\` = backslash  

---

# Check your escapes with `writeLines()`

```{r}
writeLines("Nitwit! \n\tBlubber! \n\t\tOddment! \n\U1F9D9\t\t\tTweak!")
```

_You can also write emojis (or Hebrew letters) this way!_

---

# UTF-8 

Character-encoding system of choice but not fully supported by Windows (yet); this is how you can write in Hebrew, English, Chinese, and emojis in one sentence

Want to write in Hebrew? If regular Hebrew doesn't work, you can use the code:

```{r}
writeLines("\U05DB\U05EA\U05D1") 
# write the letters-codes left-to-right but it prints right-to-left
```

---

class: inverse

# stringr

.center[
![](https://stringr.tidyverse.org/logo.png)

https://stringr.tidyverse.org  

_A consistent, simple and easy-to-use set of wrappers around the `stringi` package._
]

---

# General pattern

.center[.xlarge[
str_.gray[verb](.gray[text], .gray[...]) 
]] 

.large[
text = character string or vector

... = additional arguments include `pattern` to match or string to replace with
]
---

# Functions for the day

.large[
- `str_count()`
- `str_detect()`
- `str_subset()`
- `str_view()`
- `str_extract()`, `str_remove()`, `str_replace()`
]

---

# Let's get some data

```{r}
# from the rcorpora package
spells <- read_rds("data/spells.rds")

(incantation <- spells$incantation[1:5])
```

---

# Warm up

```{r}
# often a useful first step to avoid dealing with capitals
str_to_lower(incantation) 

str_count(incantation)

str_glue('Hermione shouted, "{incantation}!"')
```

---

# Level 2: add a pattern

```{r}
str_detect(incantation, "o")

str_subset(incantation, "o")
```

--

```{r}
str_extract(incantation, "o.")

str_replace(incantation, "o", "!")
```

---

# Once more, with feeling!

```{r}
str_extract_all(incantation, "o.")
```

---

# Once more, with feeling!

```{r}
str_replace_all(incantation, "o", "!")
```

---

class: exercise

# Your turn

How many `object`s are there in the effect description? Replace `object` with a different noun. 

```{r}
spells
```


---

class: inverse, center, middle

.xlarge[regex]

## regular expresions

---

# regex helpers

.center[.xlarge[`str_view_all()`]] 

and `str_view()` are your friends

Other resources:

- [regex101](https://regex101.com) - interepret regex
- [regexplain](https://www.garrickadenbuie.com/project/regexplain/) - interpret and write regex (lots of cheatsheets)
- [rex](https://github.com/kevinushey/rex) package - "friendly" regex
- [rebus](https://cran.r-project.org/web/packages/rebus/rebus.pdf) pacjkage - "friendly" regex

---

# Key expressions that I use
  
`.` = anything  
`*` = 0 or more  
`+` = 1 or more  
  
`^` = start  
`$` = end  
  
`[a-z]` = any lower case letters  
`[0-9]` = any number from 0 to 9

variations on the theme:  
`[09-]` = 0, 9, or -

---

class: exercise

# mini quiz



---

# how about NOT

`[^a-z]` the caret ("hat") shows up again!  this time, with a different meaning

.center[.img-big[
![](https://media.giphy.com/media/gbErpwcLlizvi/giphy.gif)
]]

---

`\w` word  

---



---

```{r}
str_split(spells$effect[1:3], " ")

str_match(spells$effect[1:3], "(\\w+) (\\w+)")
```

